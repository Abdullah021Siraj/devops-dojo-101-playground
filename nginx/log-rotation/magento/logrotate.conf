# ================================
# Logrotate configuration for Nginx & Magento2 logs
# Reusable template for servers
# ================================

# Magento2 custom error log
/var/log/nginx/magento2_error.log {
    size 50M                 # Rotate when log reaches 50MB
    rotate 5                 # Keep last 5 rotated logs
    compress                 # Compress old logs
    delaycompress            # Compress from second rotation onwards
    missingok                # Don't error if log is missing
    notifempty               # Skip empty logs
    create 640 www-data adm   # Permissions for new log file
    sharedscripts
    postrotate
        # Signal Nginx to reopen log files after rotation
        [ -f /run/nginx.pid ] && kill -USR1 `cat /run/nginx.pid`
    endscript
}

# Default Nginx logs (optional, size-based rotation)
/var/log/nginx/access.log /var/log/nginx/error.log {
    size 50M
    rotate 5
    compress
    delaycompress
    missingok
    notifempty
    create 640 www-data adm
    sharedscripts
    postrotate
        [ -f /run/nginx.pid ] && kill -USR1 `cat /run/nginx.pid`
    endscript
}
