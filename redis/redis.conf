# how to check Redis config in Docker

sudo docker exec -it redis sh
redi-cli CONFIG GET "*"

# verify the config are updated

sudo docker exec -it redis redis-cli CONFIG GET hz

# redis.conf for magento application (server is of 8GiB and 2 core)

  ########################################
# REDIS CONFIG – OPTIMIZED FOR MAGENTO
# Purpose:
# - Cache (config, layout, block_html, FPC)
# - Sessions
# - High concurrency, low latency
########################################


########################
# MEMORY CONTROL
########################

# Maximum memory Redis is allowed to use.
# IMPORTANT:
# - Must be LESS than total system RAM
# - Prevents Redis from triggering OOM killer
# - For Magento, allocate enough to hold FPC + sessions
maxmemory 2gb

# Eviction policy when maxmemory is reached.
# allkeys-lru:
# - Evicts least-recently-used keys (ANY key)
# - Required for Magento because not all cache keys have TTL
# - Prevents memory leaks and Redis crashes
maxmemory-policy allkeys-lru


########################
# LAZY FREEING (CRITICAL FOR MAGENTO)
########################

# Enable non-blocking memory freeing for evicted keys.
# Prevents Redis from freezing when large Magento cache entries are deleted.
lazyfree-lazy-eviction yes

# Enable non-blocking deletion of expired keys.
# Prevents latency spikes when many Magento cache keys expire at once.
lazyfree-lazy-expire yes

# Enable background deletion when keys are deleted by Redis internally.
# Reduces blocking during cache flushes and automatic cleanup.
lazyfree-lazy-server-del yes

# Enable background deletion when keys are deleted by applications.
# Important for Magento cache:flush and deployment operations.
lazyfree-lazy-user-del yes


########################
# ACTIVE MEMORY DEFRAGMENTATION
########################

# Enable Redis active defragmentation.
# Prevents memory fragmentation caused by frequent cache churn in Magento.
activedefrag yes

# Minimum CPU percentage Redis will use for defragmentation.
# Low impact during high traffic.
active-defrag-cycle-min 5

# Maximum CPU percentage Redis can use when server is idle.
# Allows aggressive cleanup during low traffic.
active-defrag-cycle-max 50

# Ignore defragmentation unless fragmentation exceeds this threshold.
# Avoids wasting CPU on small memory inefficiencies.
active-defrag-ignore-bytes 100mb


########################
# KEY EXPIRATION TUNING
########################

# Redis background task frequency.
# Default is 10; increased to 20 for faster cleanup.
# Helps remove expired Magento cache keys more quickly.
hz 20

# Controls how aggressively Redis expires keys.
# Scale: 1 (low) → 10 (very aggressive)
# Value 5 is balanced for Magento:
# - Prevents expired-key buildup
# - Avoids CPU spikes
active-expire-effort 5


########################################
# END OF MAGENTO-OPTIMIZED REDIS CONFIG
########################################
